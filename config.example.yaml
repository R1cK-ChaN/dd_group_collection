# DingTalk Group File Collector — Configuration
# Copy this file to config.yaml and fill in your values.
# config.yaml is gitignored — never commit it.

# ── DingTalk settings ──
dingtalk:
  # Window class name used to find the DingTalk main window.
  # Use tools/inspect_dingtalk.py to confirm the value for your version.
  window_class: "StandardFrame_DingTalk"
  # Full path to DingTalk.exe — used to auto-launch if DingTalk isn't running
  exe_path: "C:\\Program Files (x86)\\DingDing\\main\\current\\DingTalk.exe"
  # Where DingTalk saves downloaded files (check DingTalk Settings → Files)
  download_dir: "C:\\Users\\YOUR_USER\\Documents\\DingDing\\download"
  # Seconds to wait for UI controls to appear
  timeout: 10
  # Seconds to wait after clicking download before checking for the file
  download_wait: 5
  # Pixels LEFT of the row's right edge where the download icon center is
  download_icon_offset: 8

# ── Groups to collect files from ──
# name  : exact display name in DingTalk (used for search)
# alias : folder name on Google Drive (optional, defaults to name)
groups:
  - name: "YourGroupName"
    alias: "YourGroupAlias"

# ── Google Drive settings ──
gdrive:
  # Root folder where files will be organized as {alias}/{YYYY-MM}/{filename}
  base_path: "G:\\My Drive\\DingTalk Files"

# ── Polling ──
polling:
  interval_minutes: 30
  # Max files to download per group per cycle (safety cap)
  max_downloads_per_group: 50

# ── Dedup tracker ──
dedup:
  path: "data/downloaded.json"

# ── Logging ──
logging:
  dir: "logs"
  level: "INFO"
  max_bytes: 10485760      # 10 MB
  backup_count: 5

# ── Claude API (Haiku scanner + optional Opus autonomous agent) ──
claude:
  # Anthropic API key (sk-ant-api03-...) from https://console.anthropic.com
  oauth_token: ""
  # Haiku is ~20x cheaper than Sonnet; sufficient for coordinate detection
  model: "claude-haiku-4-5-20251001"
  # Scroll-up passes per group (3-8 passes × 1 API call each)
  max_scrolls: 5

# ── VLM (Vision Language Model via OpenRouter — used by --autonomous mode) ──
vlm:
  # OpenRouter API key (sk-or-...) from https://openrouter.ai
  api_key: ""
  model: "qwen/qwen-vl-plus"
  base_url: "https://openrouter.ai/api/v1"
  # Pixels around the right-click point to capture for context menu screenshot
  capture_margin: 300

# ── UI Selectors ──
# These map to uiautomation control properties.
# Update when DingTalk changes its UI. Use tools/inspect_dingtalk.py to find values.
ui_selectors:
  search_box:
    control_type: "EditControl"
    name: ""
    class_name: "QLineEdit"
  search_result_item:
    control_type: "ListItemControl"
  files_tab:
    control_type: "ButtonControl"
    name: "Files"
    fallback_control_type: "TabItemControl"
  file_list:
    control_type: "ListControl"
    name: ""
  file_item:
    control_type: "ListItemControl"
  download_button:
    control_type: "ButtonControl"
    name: "Download"
  context_menu_download:
    control_type: "MenuItemControl"
    name: "Download"
  # Dismiss-dialog button texts (checked in order)
  dismiss_buttons:
    - "Later"
    - "Cancel"
    - "OK"
    - "Ignore this version"
    - "稍后"
    - "取消"
    - "我知道了"
    - "忽略此版本"

# ── Trigger watcher (--trigger mode) ──
trigger:
  # How often to check for unread signals (seconds). 30–60 is a good range.
  check_interval_seconds: 60
  # Min red pixels in the left 200px sidebar to count as an unread badge.
  # Raise to reduce false positives; lower if badges are missed.
  red_pixel_threshold: 50
  # Seconds to wait after a download cycle before resuming watch.
  # Must be longer than download_wait + GDrive sync time (typically 60–120s).
  cooldown_seconds: 120
